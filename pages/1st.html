<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>1st Semester - Academic Resort</title>
    <link rel="stylesheet" href="../assets/styles.css" />
    <script src="../assets/script.js" defer></script>
  </head>
  <body>
    <div data-include="../assets/includes/sidebar.html"></div>
    <header class="app-header"><h1>Academic Resort</h1></header>
    <main class="container">
      <div style="margin-bottom: 24px">
        <h1
          style="
            text-align: center;
            margin: 48px 0;
            font-size: 2.5rem;
            font-weight: 600;
          "
        >
          1st Semester - Getting started
        </h1>
        <p>
          <b
            >This page contains resources for 1st Semester courses: Introduction
            to Financial Accounting (1101), Introduction to Business (1102),
            Computer Concepts and Applications (1103), Mathematics for Business
            Decisions-I (1104), and Business Communication (1105).</b
          >
        </p>
        <div class="toc-accordion">
          <div class="toc-header" onclick="toggleTOC()">
            <h4 style="margin: 0; display: inline-block">Table of Contents</h4>
            <span class="toc-toggle" id="toc-toggle">‚ñº</span>
          </div>
          <ul
            class="small toc-content"
            id="table-of-contents"
            style="display: none"
          >
            <!-- Will be populated dynamically -->
          </ul>
        </div>
      </div>

      <!-- Simple batch list -->
      <div id="batches-container">
        <section class="drive-batch-container" id="batch-30">
          <div class="card drive-embed-card">
            <div class="batch-header">
              <h2>30th Batch</h2>
              <button
                class="root-folder-btn"
                onclick="window.open('https://drive.google.com/drive/folders/1ROStto-XpFTVfxyo9SLUL6Ou78pL6sat', '_blank')"
                title="Open root folder"
              >
                ‚Üó
              </button>
            </div>
            <div class="drive-list-wrapper">
              <div class="drive-spinner" id="spinner-30"></div>
              <ul id="drive-list-30" class="drive-list"></ul>
            </div>
          </div>
        </section>

        <section class="drive-batch-container" id="batch-29">
          <div class="card drive-embed-card">
            <div class="batch-header">
              <h2>29th Batch</h2>
              <button
                class="root-folder-btn"
                onclick="window.open('https://drive.google.com/drive/folders/1SV50Qd7OcbRsMd5tHzl0qXqW6BMdQ7uO', '_blank')"
                title="Open root folder"
              >
                ‚Üó
              </button>
            </div>
            <div class="drive-list-wrapper">
              <div class="drive-spinner" id="spinner-29"></div>
              <ul id="drive-list-29" class="drive-list"></ul>
            </div>
          </div>
        </section>

        <section class="drive-batch-container" id="batch-28">
          <div class="card drive-embed-card">
            <div class="batch-header">
              <h2>28th Batch</h2>
              <button
                class="root-folder-btn"
                id="root-btn-28"
                title="Open root folder"
              >
                ‚Üó
              </button>
            </div>
            <div class="drive-list-wrapper">
              <div class="drive-spinner" id="spinner-28"></div>
              <ul id="drive-list-28" class="drive-list"></ul>
            </div>
          </div>
        </section>

        <section class="drive-batch-container" id="batch-27">
          <div class="card drive-embed-card">
            <div class="batch-header">
              <h2>27th Batch</h2>
              <button
                class="root-folder-btn"
                id="root-btn-27"
                title="Open root folder"
              >
                ‚Üó
              </button>
            </div>
            <div class="drive-list-wrapper">
              <div class="drive-spinner" id="spinner-27"></div>
              <ul id="drive-list-27" class="drive-list"></ul>
            </div>
          </div>
        </section>

        <section class="drive-batch-container" id="batch-26">
          <div class="card drive-embed-card">
            <div class="batch-header">
              <h2>26th Batch</h2>
              <button
                class="root-folder-btn"
                id="root-btn-26"
                title="Open root folder"
              >
                ‚Üó
              </button>
            </div>
            <div class="drive-list-wrapper">
              <div class="drive-spinner" id="spinner-26"></div>
              <ul id="drive-list-26" class="drive-list"></ul>
            </div>
          </div>
        </section>
      </div>
    </main>

    <div data-include="../assets/includes/footer.html"></div>

    <script>
      // Batch folders - loaded from JSON
      let batches = {};

      // API key restricted to jabir-a-h.github.io domain in Google Cloud Console
      const DRIVE_API_KEY = "AIzaSyAEOadL6D0G_c8z5EB-sEp0T3hanYAnmF0";

      // Load mapping from JSON file
      async function loadBatchMapping() {
        try {
          const response = await fetch("../assets/drive-mapping.json");
          if (!response.ok)
            throw new Error(`Failed to load mapping: ${response.status}`);
          const mapping = await response.json();

          // Extract 1st semester batches
          if (mapping["1st"] && mapping["1st"].batches) {
            Object.entries(mapping["1st"].batches).forEach(
              ([batchKey, batchData]) => {
                batches[batchKey] = batchData.folderId;
              }
            );
          }

          return batches;
        } catch (error) {
          console.error("Error loading drive mapping:", error);
          // Fallback to basic structure if JSON fails
          batches = {
            30: "1ROStto-XpFTVfxyo9SLUL6Ou78pL6sat",
            29: "1SV50Qd7OcbRsMd5tHzl0qXqW6BMdQ7uO",
          };
          return batches;
        }
      }

      // Toggle Table of Contents accordion
      function toggleTOC() {
        const tocContent = document.getElementById("table-of-contents");
        const tocToggle = document.getElementById("toc-toggle");

        if (tocContent.style.display === "none") {
          tocContent.style.display = "block";
          tocToggle.textContent = "‚ñ≤";
        } else {
          tocContent.style.display = "none";
          tocToggle.textContent = "‚ñº";
        }
      }

      // Load Drive folder contents
      async function loadBatch(batchNum, folderId) {
        const spinner = document.getElementById(`spinner-${batchNum}`);
        const list = document.getElementById(`drive-list-${batchNum}`);

        spinner.style.display = "block";

        try {
          const response = await fetch(
            `https://www.googleapis.com/drive/v3/files?q='${folderId}'+in+parents&key=${DRIVE_API_KEY}&fields=files(id,name,mimeType,webViewLink)`
          );

          if (!response.ok) {
            throw new Error(`API Error: ${response.status}`);
          }

          const data = await response.json();

          list.innerHTML = "";

          if (data.files) {
            // Sort files alphabetically by name
            data.files.sort((a, b) => a.name.localeCompare(b.name));

            data.files.forEach((file) => {
              const li = document.createElement("li");
              li.className = "drive-list-item";

              if (file.mimeType === "application/vnd.google-apps.folder") {
                // Folder with expand action only
                li.innerHTML = `
                  <div class="folder-item">
                    <a href="https://drive.google.com/drive/folders/${file.id}" target="_blank" class="folder-link">
                      üìÅ ${file.name}
                    </a>
                    <div class="folder-actions">
                      <button class="expand-btn" onclick="toggleFolderExpansion('${file.id}', this)" title="Expand folder contents">
                        ‚ñº
                      </button>
                    </div>
                  </div>
                  <ul class="subfolder-list" id="subfolder-${file.id}" style="display: none;"></ul>
                `;
              } else {
                li.innerHTML = `<a href="${
                  file.webViewLink ||
                  `https://drive.google.com/file/d/${file.id}/view`
                }" target="_blank">üìÑ ${file.name}</a>`;
              }

              list.appendChild(li);
            });
          }
        } catch (error) {
          list.innerHTML = `<li style="color: red;">Error loading files: ${error.message}</li>`;
        }

        spinner.style.display = "none";
      }

      // Toggle folder expansion
      async function toggleFolderExpansion(folderId, button) {
        const subfolderList = document.getElementById(`subfolder-${folderId}`);

        if (subfolderList.style.display === "none") {
          // Expand folder
          button.innerHTML = "‚ñ≤";
          button.title = "Collapse folder contents";
          subfolderList.style.display = "block";

          // Load folder contents if not already loaded
          if (subfolderList.children.length === 0) {
            subfolderList.innerHTML = '<li class="loading">Loading...</li>';

            try {
              const response = await fetch(
                `https://www.googleapis.com/drive/v3/files?q='${folderId}'+in+parents&key=${DRIVE_API_KEY}&fields=files(id,name,mimeType,webViewLink)`
              );

              if (!response.ok) {
                throw new Error(`API Error: ${response.status}`);
              }

              const data = await response.json();
              subfolderList.innerHTML = "";

              if (data.files && data.files.length > 0) {
                // Sort files alphabetically by name
                data.files.sort((a, b) => a.name.localeCompare(b.name));

                data.files.forEach((file) => {
                  const li = document.createElement("li");
                  li.className = "subfolder-item";

                  if (file.mimeType === "application/vnd.google-apps.folder") {
                    // Nested folder with its own dropdown
                    li.innerHTML = `
                      <div class="folder-item">
                        <a href="https://drive.google.com/drive/folders/${file.id}" target="_blank" class="folder-link">
                          üìÅ ${file.name}
                        </a>
                        <div class="folder-actions">
                          <button class="expand-btn" onclick="toggleFolderExpansion('${file.id}', this)" title="Expand folder contents">
                            ‚ñº
                          </button>
                        </div>
                      </div>
                      <ul class="subfolder-list" id="subfolder-${file.id}" style="display: none;"></ul>
                    `;
                  } else {
                    li.innerHTML = `
                      <a href="${
                        file.webViewLink ||
                        `https://drive.google.com/file/d/${file.id}/view`
                      }" target="_blank">
                        üìÑ ${file.name}
                      </a>
                    `;
                  }

                  subfolderList.appendChild(li);
                });
              } else {
                subfolderList.innerHTML =
                  '<li class="empty">No files found</li>';
              }
            } catch (error) {
              subfolderList.innerHTML = `<li class="error">Error loading: ${error.message}</li>`;
            }
          }
        } else {
          // Collapse folder
          button.innerHTML = "‚ñº";
          button.title = "Expand folder contents";
          subfolderList.style.display = "none";
        }
      }

      // Initialize
      window.addEventListener("DOMContentLoaded", async () => {
        // Add spinners
        document.querySelectorAll(".drive-spinner").forEach((spinner) => {
          spinner.innerHTML =
            '<div style="width:20px;height:20px;border:2px solid #ccc;border-top:2px solid #2196f3;border-radius:50%;animation:spin 1s linear infinite;margin:auto;"></div>';
        });

        // Load mapping first, then load all batches
        await loadBatchMapping();

        // Populate table of contents
        const toc = document.getElementById("table-of-contents");
        const batchKeys = Object.keys(batches).sort(
          (a, b) => parseInt(b) - parseInt(a)
        ); // Sort descending
        toc.innerHTML = batchKeys
          .map(
            (batchNum) =>
              `<li><a href="#batch-${batchNum}">${batchNum}th Batch</a></li>`
          )
          .join("");

        // Set up root folder buttons for batches loaded from JSON
        Object.entries(batches).forEach(([batchNum, folderId]) => {
          const rootBtn = document.getElementById(`root-btn-${batchNum}`);
          if (rootBtn) {
            rootBtn.onclick = () =>
              window.open(
                `https://drive.google.com/drive/folders/${folderId}`,
                "_blank"
              );
          }
          loadBatch(batchNum, folderId);
        });
      });
    </script>

    <style>
      .drive-search-bar {
        text-align: center;
        margin-bottom: 16px;
      }

      .toc-accordion {
        margin-bottom: 20px;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        overflow: hidden;
      }

      .toc-header {
        background: #f8f9fa;
        padding: 12px 16px;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        user-select: none;
        transition: background-color 0.2s ease;
      }

      .toc-header:hover {
        background: #e9ecef;
      }

      .toc-toggle {
        font-size: 0.9rem;
        color: #666;
        transition: transform 0.2s ease;
      }

      .toc-content {
        padding: 12px 16px;
        margin: 0;
        background: white;
        border-top: 1px solid #e0e0e0;
      }

      .toc-content li {
        margin: 4px 0;
      }

      .toc-content a {
        color: #2196f3;
        text-decoration: none;
        padding: 2px 4px;
        border-radius: 3px;
        transition: background-color 0.2s ease;
      }

      .toc-content a:hover {
        background-color: #f0f8ff;
      }
      .drive-search-bar input {
        padding: 8px 16px;
        font-size: 1rem;
        border-radius: 8px;
        border: 1px solid #ccc;
        width: 320px;
      }
      .drive-batch-container {
        margin-bottom: 24px;
      }
      .drive-embed-card {
        box-shadow: 0 2px 12px #0001;
        border-radius: 12px;
        padding: 20px;
      }

      .batch-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
      }

      .batch-header h2 {
        margin: 0;
      }

      .root-folder-btn {
        background: none;
        color: #666;
        border: 1px solid #ddd;
        padding: 6px 8px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: all 0.2s ease;
      }

      .root-folder-btn:hover {
        background: #f5f5f5;
        color: #2196f3;
        border-color: #2196f3;
      }
      .drive-desc {
        color: #555;
        margin-bottom: 12px;
      }
      .drive-list-wrapper {
        position: relative;
        min-height: 120px;
      }
      .drive-spinner {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 2;
      }
      .drive-list {
        list-style: none;
        padding-left: 0;
        margin: 0;
      }
      .drive-list-item {
        padding: 8px 0 8px 20px;
        border-bottom: 1px solid #eee;
        font-size: 1rem;
      }

      .folder-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .folder-link {
        flex-grow: 1;
        text-decoration: none;
        color: #333;
      }

      .folder-link:hover {
        color: #2196f3;
      }

      .folder-actions {
        display: flex;
        gap: 4px;
      }

      .expand-btn,
      .popup-btn {
        background: none;
        border: 1px solid #ddd;
        padding: 4px 8px;
        cursor: pointer;
        border-radius: 4px;
        font-size: 12px;
      }

      .expand-btn:hover,
      .popup-btn:hover {
        background-color: #f0f0f0;
      }

      .subfolder-list {
        list-style: none;
        padding-left: 20px;
        margin: 8px 0;
        border-left: 2px solid #eee;
      }

      .subfolder-item {
        padding: 4px 0;
        font-size: 0.9rem;
      }

      .subfolder-item .folder-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 2px 0;
      }

      .subfolder-item .folder-actions {
        display: flex;
        gap: 2px;
      }

      .subfolder-item .expand-btn {
        padding: 2px 6px;
        font-size: 10px;
      }

      .subfolder-item a {
        text-decoration: none;
        color: #666;
      }

      .subfolder-item a:hover {
        color: #2196f3;
      }

      /* Nested subfolders with increased indentation */
      .subfolder-list .subfolder-list {
        padding-left: 15px;
        border-left: 1px solid #ddd;
      }

      .loading,
      .error,
      .empty {
        color: #999;
        font-style: italic;
        padding: 8px 0;
      }

      .error {
        color: #e74c3c;
      }
      .drive-list-item .folder-toggle {
        cursor: pointer;
        margin-right: 8px;
        font-size: 1.1em;
        color: #2196f3;
      }
      .drive-list-item .folder-name {
        font-weight: 600;
        color: #333;
      }
      .drive-list-nested {
        list-style: none;
        margin-left: 24px;
        padding-left: 0;
        border-left: 2px solid #eee;
      }
      .drive-file-link {
        color: #2196f3;
        text-decoration: none;
        font-weight: 500;
      }
      .drive-file-link:hover {
        text-decoration: underline;
      }
      .drive-list-error {
        color: #d32f2f;
        font-weight: 600;
        padding: 12px;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </body>
</html>
